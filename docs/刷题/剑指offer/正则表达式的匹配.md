---
title: 正则表达式的匹配
author: 熊滔
category: 剑指offer
---

> 题目：请实现一个函数用来匹配包含 `'.'` 和 `'*'` 的正则表达式，模式中的字符 `'.'` 表示任意一个字符，而 `'*'` 表示它前面的字符可以出现任意次(含 `0` 次)。在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串 `"aaa"` 与模式字符串 `"a.a"` 和 `"ab*ac*a"` 匹配，但是与 `"aa.a"` 和 `"ab*a"` 均不匹配。


<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/match202006122123.svg"/>

在匹配字符串时，每次我们拿出匹配字符串中的一个字符与模式字符串中的字符进行匹配，匹配字符与模式字符之间的匹配分为三种情况：

1. 当前要匹配的模式字符的下一个字符不是 `'*'`，那么当匹配字符与模式字符相同或者模式字符为 `'.'` 时都算匹配成功，当匹配成功时，进行匹配下一个字符

   <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/match202006122054.svg"/>
   
2. 模式字符的后一位为 `'*'`，并且当前字符匹配时，因为 `'*'` 代表任意次，它可以有以下三种匹配行为

   <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/match202006122102.svg"/>
   
   
- 选择只匹配一个
   
  <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/match202006122106.svg"/>
     
   - 选择不匹配
   
  <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/match202006122108.svg"/>
     
- 选择匹配多个
   
     <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/match202006122109.svg"/>
   
上述三种行为，只要有一种情况匹配最后匹配成功，那么就匹配成功，所以它们之间是或的关系。
   
3. 模式字符的后一位为 `'*'`，并且当前字符不匹配时
   
   <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/match202006122120.svg"/>

当匹配字符与模式字符匹配成功时，才继续进行匹配，当匹配字符串和模式字符串同时匹配完毕时，那么说匹配字符串与模式字符串匹配成功了，代码如下

```java
public class Match {
    public static boolean match(char[] str, char[] pattern) {
        if (str == null || pattern == null) {
            return false;
        }
		
        // 匹配字符串和模式字符串都从起始字符进行匹配
        return matchCore(str, 0, pattern, 0);
    }

    private static boolean matchCore(char[] str, int strIndex, char[] pattern, int patternIndex) {
        // 二者同时匹配完毕时，才匹配成功
        if (strIndex == str.length  && patternIndex == pattern.length) {
            return true;
        }

        // 模式字符串匹配完毕，但是匹配字符串还有字符没有匹配
        if (strIndex != str.length && patternIndex == pattern.length) {
            return false;
        }

        // 匹配字符串匹配完毕，但是模式字符串还有字符未被匹配
        if (strIndex == str.length && patternIndex != pattern.length) {
            return false;
        }

        // 如果下一个字符为 *
        if ((patternIndex + 1) < pattern.length && pattern[patternIndex + 1] == '*') {
            // 匹配时有三种选择
            if (pattern[patternIndex] == str[strIndex] || pattern[patternIndex] == '.') {
                boolean result = matchCore(str, strIndex + 1, pattern, patternIndex + 2)
                || matchCore(str, strIndex + 1, pattern, patternIndex)
                || matchCore(str, strIndex, pattern, patternIndex + 2);
                return result;
            } else {
                // 当前字符不匹配，匹配字符向后移两个字符
                return matchCore(str, strIndex, pattern, patternIndex + 2);
            }
        }

        // 第二个字符不为*，这时如果匹配字符与模式字符相同或者模式字符为 .都算匹配成功
        // 这时匹配字符和模式字符都向后移一个字符
        if (str[strIndex] == pattern[patternIndex] || (pattern[patternIndex] == '.')) {
            return matchCore(str, strIndex + 1, pattern, patternIndex + 1);
        }

        return false;
    }
}
```



<Disqus />